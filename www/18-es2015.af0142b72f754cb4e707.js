(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{aO22:function(e,t,n){"use strict";n.r(t),n.d(t,"PurchasePaymentPageModule",(function(){return g}));var o=n("ofXK"),r=n("3Pt+"),i=n("TEn/"),l=n("tyNb"),a=n("mrSG"),s=n("tk/3"),d=n("AytR"),m=n("fXoL");function c(e,t){if(1&e){const e=m["\u0275\u0275getCurrentView"]();m["\u0275\u0275elementStart"](0,"div"),m["\u0275\u0275elementStart"](1,"ion-toolbar"),m["\u0275\u0275elementStart"](2,"ion-title"),m["\u0275\u0275text"](3,"Direcci\xf3n"),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementStart"](4,"ion-item"),m["\u0275\u0275elementStart"](5,"ion-label",7),m["\u0275\u0275text"](6,"Calle"),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementStart"](7,"ion-input",12),m["\u0275\u0275listener"]("ngModelChange",(function(t){return m["\u0275\u0275restoreView"](e),m["\u0275\u0275nextContext"](2).user[0].calle=t})),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementStart"](8,"ion-item"),m["\u0275\u0275elementStart"](9,"ion-label",7),m["\u0275\u0275text"](10,"Poblaci\xf3n"),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementStart"](11,"ion-input",12),m["\u0275\u0275listener"]("ngModelChange",(function(t){return m["\u0275\u0275restoreView"](e),m["\u0275\u0275nextContext"](2).user[0].poblacion=t})),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementStart"](12,"ion-item"),m["\u0275\u0275elementStart"](13,"ion-label",7),m["\u0275\u0275text"](14,"CP"),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementStart"](15,"ion-input",13),m["\u0275\u0275listener"]("ngModelChange",(function(t){return m["\u0275\u0275restoreView"](e),m["\u0275\u0275nextContext"](2).user[0].CP=t})),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementStart"](16,"ion-item"),m["\u0275\u0275elementStart"](17,"ion-label",7),m["\u0275\u0275text"](18,"Tel\xe9fono"),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementStart"](19,"ion-input",14),m["\u0275\u0275listener"]("ngModelChange",(function(t){return m["\u0275\u0275restoreView"](e),m["\u0275\u0275nextContext"](2).user[0].telefono=t})),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementEnd"]()}if(2&e){const e=m["\u0275\u0275nextContext"](2);m["\u0275\u0275advance"](7),m["\u0275\u0275property"]("ngModel",e.user[0].calle),m["\u0275\u0275advance"](4),m["\u0275\u0275property"]("ngModel",e.user[0].poblacion),m["\u0275\u0275advance"](4),m["\u0275\u0275property"]("ngModel",e.user[0].CP),m["\u0275\u0275advance"](4),m["\u0275\u0275property"]("ngModel",e.user[0].telefono)}}function u(e,t){if(1&e){const e=m["\u0275\u0275getCurrentView"]();m["\u0275\u0275elementStart"](0,"div"),m["\u0275\u0275elementStart"](1,"ion-toolbar"),m["\u0275\u0275elementStart"](2,"ion-title"),m["\u0275\u0275text"](3,"Env\xedo"),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementStart"](4,"ion-list"),m["\u0275\u0275elementStart"](5,"ion-radio-group",3),m["\u0275\u0275listener"]("ngModelChange",(function(t){return m["\u0275\u0275restoreView"](e),m["\u0275\u0275nextContext"]().deliveryType=t})),m["\u0275\u0275elementStart"](6,"ion-item"),m["\u0275\u0275elementStart"](7,"ion-label"),m["\u0275\u0275text"](8,"Recoger en tienda"),m["\u0275\u0275elementEnd"](),m["\u0275\u0275element"](9,"ion-radio",4),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementStart"](10,"ion-item"),m["\u0275\u0275elementStart"](11,"ion-label"),m["\u0275\u0275text"](12,"Env\xedo a domicilio"),m["\u0275\u0275elementEnd"](),m["\u0275\u0275element"](13,"ion-radio",5),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementEnd"](),m["\u0275\u0275template"](14,c,20,4,"div",2),m["\u0275\u0275elementStart"](15,"ion-item"),m["\u0275\u0275elementStart"](16,"ion-label"),m["\u0275\u0275text"](17,"Fecha de reparto"),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementStart"](18,"ion-datetime",6),m["\u0275\u0275listener"]("ngModelChange",(function(t){return m["\u0275\u0275restoreView"](e),m["\u0275\u0275nextContext"]().myDate=t})),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementStart"](19,"ion-item"),m["\u0275\u0275elementStart"](20,"ion-label",7),m["\u0275\u0275text"](21,"\xbfAlgo que a\xf1adir?"),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementStart"](22,"ion-textarea",8),m["\u0275\u0275listener"]("ngModelChange",(function(t){return m["\u0275\u0275restoreView"](e),m["\u0275\u0275nextContext"]().orderNotes=t})),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementStart"](23,"ion-toolbar"),m["\u0275\u0275elementStart"](24,"ion-title"),m["\u0275\u0275text"](25,"Forma de pago"),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementStart"](26,"ion-list"),m["\u0275\u0275elementStart"](27,"ion-radio-group",3),m["\u0275\u0275listener"]("ngModelChange",(function(t){return m["\u0275\u0275restoreView"](e),m["\u0275\u0275nextContext"]().chargesType=t})),m["\u0275\u0275elementStart"](28,"ion-item"),m["\u0275\u0275elementStart"](29,"ion-label"),m["\u0275\u0275text"](30,"Efectivo"),m["\u0275\u0275elementEnd"](),m["\u0275\u0275element"](31,"ion-radio",9),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementStart"](32,"ion-item"),m["\u0275\u0275elementStart"](33,"ion-label"),m["\u0275\u0275text"](34,"Tarjeta"),m["\u0275\u0275elementEnd"](),m["\u0275\u0275element"](35,"ion-radio",10),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementStart"](36,"ion-row"),m["\u0275\u0275element"](37,"ion-col"),m["\u0275\u0275elementStart"](38,"ion-col"),m["\u0275\u0275elementStart"](39,"ion-button",11),m["\u0275\u0275listener"]("click",(function(){return m["\u0275\u0275restoreView"](e),m["\u0275\u0275nextContext"]().charge()})),m["\u0275\u0275text"](40," Realizar pedido "),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementEnd"]()}if(2&e){const e=m["\u0275\u0275nextContext"]();m["\u0275\u0275advance"](5),m["\u0275\u0275property"]("ngModel",e.deliveryType),m["\u0275\u0275advance"](9),m["\u0275\u0275property"]("ngIf","domicilio"==e.deliveryType),m["\u0275\u0275advance"](4),m["\u0275\u0275property"]("min",e.myDate)("ngModel",e.myDate),m["\u0275\u0275advance"](4),m["\u0275\u0275property"]("ngModel",e.orderNotes),m["\u0275\u0275advance"](5),m["\u0275\u0275property"]("ngModel",e.chargesType)}}const p=[{path:"",component:(()=>{class e{constructor(e,t,n,o,r){this.http=e,this.navCtrl=t,this.loadingController=n,this.alertController=o,this.toastController=r,this.myDate=(new Date).toISOString(),this.products=[],this.total=0,this.family=[],this.orderNotes="",this.chargesType="tarjeta",this.deliveryType="tienda"}ngOnInit(){this.total=history.state.total,this.load()}load(){this.user=localStorage.getItem("identity"),this.user=JSON.parse(this.user);let e="",t=localStorage.getItem("cart");this.products=JSON.parse(t);for(let n=0;n<this.products.length;n++)this.products[n].name=decodeURIComponent(this.products[n].name),this.family.forEach(t=>{t.id==this.products[n].familyId&&(e=t.name)}),this.products[n].familyName=e;this.shippingType||(this.shipping=this.total>30?0:5)}buy(){this.orderNotes+="tienda"==this.deliveryType?" -  "+this.deliveryType:" - "+this.deliveryType+" - "+this.user[0].calle+" "+this.user[0].poblacion+" "+this.user[0].CP;var e={orderLines:JSON.stringify(this.products).replace(/\"/gi,"'"),cashDiscount:0,grossAmount:this.total,surchargeRate:0,netAmount:0,vatAmount:0,surchargeAmount:0,sended:!0,userId:this.user[0].id,userName:this.user[0].name+" "+this.user[0].lastname,userPhone:this.user[0].telefono,email:this.user[0].email,deliveryDate:this.myDate,orderNotes:this.orderNotes,chargesType:this.chargesType};let t=new s.c({"Content-Type":"application/json",Authorization:localStorage.getItem("token")});this.http.post(d.a.APIURL+"/order",e,{headers:t}).subscribe(e=>Object(a.a)(this,void 0,void 0,(function*(){localStorage.removeItem("cart"),localStorage.setItem("cart",JSON.stringify({})),(yield this.toastController.create({message:"Pedido realizado \u{1f389}",duration:2e3,color:"success"})).present(),this.navCtrl.navigateRoot("/home")})),e=>{})}charge(){return Object(a.a)(this,void 0,void 0,(function*(){const e=yield this.loadingController.create({message:"Preparando pedido...",translucent:!0});yield e.present(),"tarjeta"==this.chargesType?window.StripeCheckout.configure({key:d.a.STRIPEPK,locale:"auto",token:e=>{var t={stripeToken:e.id,amount:100*this.total};let n=new s.c({"Content-Type":"application/json",Accept:"application/json"});this.http.post(d.a.APIURL+"/charge",t,{headers:n}).subscribe(e=>{this.buy()},e=>Object(a.a)(this,void 0,void 0,(function*(){const e=yield this.alertController.create({header:"Contacta con nosotros por favor",message:"Parece que tenemos problemas \u{1f974}",buttons:[{text:"Okay"}]});yield e.present()})))}}).open({name:"Tu Empresa Checkout",description:"",amount:100*this.total}):this.buy(),this.loadingController.dismiss()}))}}return e.\u0275fac=function(t){return new(t||e)(m["\u0275\u0275directiveInject"](s.a),m["\u0275\u0275directiveInject"](i.Q),m["\u0275\u0275directiveInject"](i.O),m["\u0275\u0275directiveInject"](i.b),m["\u0275\u0275directiveInject"](i.X))},e.\u0275cmp=m["\u0275\u0275defineComponent"]({type:e,selectors:[["app-purchase-payment"]],decls:10,vars:1,consts:[["color","success"],["name","logo-whatsapp"],[4,"ngIf"],["value","efectivo",3,"ngModel","ngModelChange"],["slot","start","value","tienda"],["slot","start","value","domicilio"],["displayFormat","MMM DD, YYYY HH:mm","minuteValues","00,15, 30, 45",3,"min","ngModel","ngModelChange"],["position","floating"],[3,"ngModel","ngModelChange"],["slot","start","value","efectivo"],["slot","start","value","tarjeta"],[3,"click"],["type","text",3,"ngModel","ngModelChange"],["type","number",3,"ngModel","ngModelChange"],["type","tel",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(m["\u0275\u0275elementStart"](0,"ion-content"),m["\u0275\u0275elementStart"](1,"ion-card"),m["\u0275\u0275elementStart"](2,"ion-card-header"),m["\u0275\u0275elementStart"](3,"h5"),m["\u0275\u0275text"](4,"\xbfProblemas con tu pedido?"),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementStart"](5,"ion-card-content"),m["\u0275\u0275elementStart"](6,"ion-button",0),m["\u0275\u0275text"](7,"Whatshap \xa0 "),m["\u0275\u0275element"](8,"ion-icon",1),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementEnd"](),m["\u0275\u0275elementEnd"](),m["\u0275\u0275template"](9,u,41,6,"div",2),m["\u0275\u0275elementEnd"]()),2&e&&(m["\u0275\u0275advance"](9),m["\u0275\u0275property"]("ngIf",t.user))},directives:[i.o,i.i,i.k,i.j,i.g,i.s,o.k,i.L,i.K,i.w,i.C,i.V,r.d,r.g,i.u,i.v,i.B,i.T,i.p,i.J,i.W,i.G,i.n,i.t,i.R],styles:["ion-col[_ngcontent-%COMP%]{text-align:right}ion-card[_ngcontent-%COMP%]{text-align:center}"]}),e})()}];let h=(()=>{class e{}return e.\u0275mod=m["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=m["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[l.i.forChild(p)],l.i]}),e})(),g=(()=>{class e{}return e.\u0275mod=m["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=m["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[o.b,r.a,i.M,h,r.i]]}),e})()}}]);