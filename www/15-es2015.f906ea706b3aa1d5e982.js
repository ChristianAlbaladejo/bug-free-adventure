(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{YiOL:function(e,t,n){"use strict";n.r(t),n.d(t,"OrdersPageModule",(function(){return f}));var r=n("ofXK"),o=n("3Pt+"),i=n("TEn/"),s=n("tyNb"),l=n("mrSG"),a=n("S3Px"),c=n("fXoL");function d(e,t){if(1&e){const e=c["\u0275\u0275getCurrentView"]();c["\u0275\u0275elementStart"](0,"ion-icon",7),c["\u0275\u0275listener"]("click",(function(){return c["\u0275\u0275restoreView"](e),c["\u0275\u0275nextContext"]().gotoLogin()})),c["\u0275\u0275elementEnd"]()}}function u(e,t){if(1&e&&(c["\u0275\u0275elementStart"](0,"p"),c["\u0275\u0275text"](1),c["\u0275\u0275elementEnd"]()),2&e){const e=t.$implicit;c["\u0275\u0275advance"](1),c["\u0275\u0275textInterpolate2"]("",e.name," x",e.quantity,"")}}function p(e,t){if(1&e){const e=c["\u0275\u0275getCurrentView"]();c["\u0275\u0275elementStart"](0,"ion-item",9),c["\u0275\u0275listener"]("click",(function(){c["\u0275\u0275restoreView"](e);const n=t.$implicit;return c["\u0275\u0275nextContext"](2).tab(n.orderLines)})),c["\u0275\u0275elementStart"](1,"ion-label"),c["\u0275\u0275elementStart"](2,"h2"),c["\u0275\u0275text"](3),c["\u0275\u0275pipe"](4,"date"),c["\u0275\u0275elementEnd"](),c["\u0275\u0275template"](5,u,2,2,"p",10),c["\u0275\u0275elementStart"](6,"h3"),c["\u0275\u0275text"](7),c["\u0275\u0275pipe"](8,"number"),c["\u0275\u0275elementEnd"](),c["\u0275\u0275elementEnd"](),c["\u0275\u0275elementEnd"]()}if(2&e){const e=t.$implicit;c["\u0275\u0275advance"](3),c["\u0275\u0275textInterpolate1"]("Pedido del dia: ",c["\u0275\u0275pipeBind1"](4,3,e.date),""),c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngForOf",e.orderLines),c["\u0275\u0275advance"](2),c["\u0275\u0275textInterpolate1"]("",c["\u0275\u0275pipeBind2"](8,5,e.grossAmount,"1.2-2")," \u20ac")}}function m(e,t){if(1&e&&(c["\u0275\u0275elementStart"](0,"ion-list"),c["\u0275\u0275template"](1,p,9,8,"ion-item",8),c["\u0275\u0275elementEnd"]()),2&e){const e=c["\u0275\u0275nextContext"]();c["\u0275\u0275advance"](1),c["\u0275\u0275property"]("ngForOf",e.orders)}}const g=[{path:"",component:(()=>{class e{constructor(e,t,n,r,o){this._productsService=e,this.navCtrl=t,this.loadingController=n,this.actionSheetController=r,this.toastController=o,this.orders=[],this.cart=[],this.user=localStorage.getItem("identity"),this.user=JSON.parse(this.user)}ngOnInit(){return Object(l.a)(this,void 0,void 0,(function*(){this.load(),this.cart=[];let e=localStorage.getItem("cart");e=JSON.parse(e);for(let t=0;t<e.length;t++)this.cart.push(e[t])}))}ionViewDidEnter(){this.ngOnInit()}load(){return Object(l.a)(this,void 0,void 0,(function*(){const e=yield this.loadingController.create({message:"Cargando...",translucent:!0});yield e.present(),this.orders=[],this._productsService.getSalesOrders(this.user[0].id).subscribe(e=>{this.orders=e;for(let t=0;t<this.orders.length;t++)this.orders[t].orderLines=this.orders[t].orderLines.replace(/'/g,'"'),this.orders[t].orderLines=JSON.parse(this.orders[t].orderLines);this.orders=this.orders.reverse(),this.loadingController.dismiss()},e=>{console.log(e),this.loadingController.dismiss()})}))}addToCart(e){return Object(l.a)(this,void 0,void 0,(function*(){console.log(e.length);let t=!1,n=[],r=localStorage.getItem("cart");n=JSON.parse(r);for(let o=0;o<n.length;o++)for(let r=0;r<e.length;r++)n[o].id==e[r].id?(n[o].quantity+=e[r].quantity,t=!0):n.some(t=>t.id===e[r].id)||n.push(e[r]);if(t)localStorage.setItem("cart",JSON.stringify(n));else{for(let t=0;t<e.length;t++)this.cart.push(e[t]);localStorage.setItem("cart",JSON.stringify(this.cart))}(yield this.toastController.create({message:"Pedido a\xf1adido",duration:2e3,color:"success"})).present(),this.navCtrl.navigateForward("/home")}))}ifLogin(){return null==JSON.parse(localStorage.getItem("identity"))}gotoCart(){this.ifLogin()?this.navCtrl.navigateForward("/login"):this.navCtrl.navigateForward("/cart")}tab(e){return Object(l.a)(this,void 0,void 0,(function*(){const t=yield this.actionSheetController.create({header:"Realizar pedido",buttons:[{text:"repetir pedido",icon:"repeat-outline",handler:()=>{this.addToCart(e)}},{text:"Cancel",icon:"close",role:"cancel",handler:()=>{console.log("Cancel clicked")}}]});yield t.present()}))}gotoLogin(){this.navCtrl.navigateForward("/cart")}}return e.\u0275fac=function(t){return new(t||e)(c["\u0275\u0275directiveInject"](a.a),c["\u0275\u0275directiveInject"](i.Q),c["\u0275\u0275directiveInject"](i.O),c["\u0275\u0275directiveInject"](i.a),c["\u0275\u0275directiveInject"](i.X))},e.\u0275cmp=c["\u0275\u0275defineComponent"]({type:e,selectors:[["app-orders"]],features:[c["\u0275\u0275ProvidersFeature"]([a.a])],decls:14,vars:4,consts:[[3,"translucent"],["slot","start"],["slot","end",3,"click"],["slot","end","name","person-outline",3,"click",4,"ngIf"],["slot","icon-only","name","cart-outline"],["color","danger",2,"position","absolute","right","-4px","top","-2px"],[4,"ngIf"],["slot","end","name","person-outline",3,"click"],[3,"click",4,"ngFor","ngForOf"],[3,"click"],[4,"ngFor","ngForOf"]],template:function(e,t){1&e&&(c["\u0275\u0275elementStart"](0,"ion-header",0),c["\u0275\u0275elementStart"](1,"ion-toolbar"),c["\u0275\u0275elementStart"](2,"ion-buttons",1),c["\u0275\u0275element"](3,"ion-menu-button"),c["\u0275\u0275element"](4,"ion-back-button"),c["\u0275\u0275elementEnd"](),c["\u0275\u0275elementStart"](5,"ion-title"),c["\u0275\u0275text"](6,"Tus pedidos"),c["\u0275\u0275elementEnd"](),c["\u0275\u0275elementStart"](7,"ion-buttons",2),c["\u0275\u0275listener"]("click",(function(){return t.gotoCart()})),c["\u0275\u0275template"](8,d,1,0,"ion-icon",3),c["\u0275\u0275element"](9,"ion-icon",4),c["\u0275\u0275elementStart"](10,"ion-badge",5),c["\u0275\u0275text"](11),c["\u0275\u0275elementEnd"](),c["\u0275\u0275elementEnd"](),c["\u0275\u0275elementEnd"](),c["\u0275\u0275elementEnd"](),c["\u0275\u0275elementStart"](12,"ion-content"),c["\u0275\u0275template"](13,m,2,1,"ion-list",6),c["\u0275\u0275elementEnd"]()),2&e&&(c["\u0275\u0275property"]("translucent",!0),c["\u0275\u0275advance"](8),c["\u0275\u0275property"]("ngIf",t.ifLogin()),c["\u0275\u0275advance"](3),c["\u0275\u0275textInterpolate"](null==t.cart?null:t.cart.length),c["\u0275\u0275advance"](2),c["\u0275\u0275property"]("ngIf",t.orders))},directives:[i.r,i.L,i.h,i.z,i.d,i.e,i.K,r.k,i.s,i.f,i.o,i.w,r.j,i.u,i.v],pipes:[r.d,r.e],styles:["ion-icon[_ngcontent-%COMP%]{zoom:1.2}"]}),e})()}];let h=(()=>{class e{}return e.\u0275mod=c["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=c["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[s.i.forChild(g)],s.i]}),e})(),f=(()=>{class e{}return e.\u0275mod=c["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=c["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[r.b,o.a,i.M,h]]}),e})()}}]);