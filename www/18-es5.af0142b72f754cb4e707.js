!function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{aO22:function(n,r,o){"use strict";o.r(r),o.d(r,"PurchasePaymentPageModule",(function(){return E}));var i=o("ofXK"),a=o("3Pt+"),l=o("TEn/"),s=o("tyNb"),d=o("mrSG"),c=o("tk/3"),m=o("AytR"),u=o("fXoL");function p(e,t){if(1&e){var n=u["\u0275\u0275getCurrentView"]();u["\u0275\u0275elementStart"](0,"div"),u["\u0275\u0275elementStart"](1,"ion-toolbar"),u["\u0275\u0275elementStart"](2,"ion-title"),u["\u0275\u0275text"](3,"Direcci\xf3n"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](4,"ion-item"),u["\u0275\u0275elementStart"](5,"ion-label",7),u["\u0275\u0275text"](6,"Calle"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](7,"ion-input",12),u["\u0275\u0275listener"]("ngModelChange",(function(e){return u["\u0275\u0275restoreView"](n),u["\u0275\u0275nextContext"](2).user[0].calle=e})),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](8,"ion-item"),u["\u0275\u0275elementStart"](9,"ion-label",7),u["\u0275\u0275text"](10,"Poblaci\xf3n"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](11,"ion-input",12),u["\u0275\u0275listener"]("ngModelChange",(function(e){return u["\u0275\u0275restoreView"](n),u["\u0275\u0275nextContext"](2).user[0].poblacion=e})),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](12,"ion-item"),u["\u0275\u0275elementStart"](13,"ion-label",7),u["\u0275\u0275text"](14,"CP"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](15,"ion-input",13),u["\u0275\u0275listener"]("ngModelChange",(function(e){return u["\u0275\u0275restoreView"](n),u["\u0275\u0275nextContext"](2).user[0].CP=e})),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](16,"ion-item"),u["\u0275\u0275elementStart"](17,"ion-label",7),u["\u0275\u0275text"](18,"Tel\xe9fono"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](19,"ion-input",14),u["\u0275\u0275listener"]("ngModelChange",(function(e){return u["\u0275\u0275restoreView"](n),u["\u0275\u0275nextContext"](2).user[0].telefono=e})),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"]()}if(2&e){var r=u["\u0275\u0275nextContext"](2);u["\u0275\u0275advance"](7),u["\u0275\u0275property"]("ngModel",r.user[0].calle),u["\u0275\u0275advance"](4),u["\u0275\u0275property"]("ngModel",r.user[0].poblacion),u["\u0275\u0275advance"](4),u["\u0275\u0275property"]("ngModel",r.user[0].CP),u["\u0275\u0275advance"](4),u["\u0275\u0275property"]("ngModel",r.user[0].telefono)}}function h(e,t){if(1&e){var n=u["\u0275\u0275getCurrentView"]();u["\u0275\u0275elementStart"](0,"div"),u["\u0275\u0275elementStart"](1,"ion-toolbar"),u["\u0275\u0275elementStart"](2,"ion-title"),u["\u0275\u0275text"](3,"Env\xedo"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](4,"ion-list"),u["\u0275\u0275elementStart"](5,"ion-radio-group",3),u["\u0275\u0275listener"]("ngModelChange",(function(e){return u["\u0275\u0275restoreView"](n),u["\u0275\u0275nextContext"]().deliveryType=e})),u["\u0275\u0275elementStart"](6,"ion-item"),u["\u0275\u0275elementStart"](7,"ion-label"),u["\u0275\u0275text"](8,"Recoger en tienda"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275element"](9,"ion-radio",4),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](10,"ion-item"),u["\u0275\u0275elementStart"](11,"ion-label"),u["\u0275\u0275text"](12,"Env\xedo a domicilio"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275element"](13,"ion-radio",5),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275template"](14,p,20,4,"div",2),u["\u0275\u0275elementStart"](15,"ion-item"),u["\u0275\u0275elementStart"](16,"ion-label"),u["\u0275\u0275text"](17,"Fecha de reparto"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](18,"ion-datetime",6),u["\u0275\u0275listener"]("ngModelChange",(function(e){return u["\u0275\u0275restoreView"](n),u["\u0275\u0275nextContext"]().myDate=e})),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](19,"ion-item"),u["\u0275\u0275elementStart"](20,"ion-label",7),u["\u0275\u0275text"](21,"\xbfAlgo que a\xf1adir?"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](22,"ion-textarea",8),u["\u0275\u0275listener"]("ngModelChange",(function(e){return u["\u0275\u0275restoreView"](n),u["\u0275\u0275nextContext"]().orderNotes=e})),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](23,"ion-toolbar"),u["\u0275\u0275elementStart"](24,"ion-title"),u["\u0275\u0275text"](25,"Forma de pago"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](26,"ion-list"),u["\u0275\u0275elementStart"](27,"ion-radio-group",3),u["\u0275\u0275listener"]("ngModelChange",(function(e){return u["\u0275\u0275restoreView"](n),u["\u0275\u0275nextContext"]().chargesType=e})),u["\u0275\u0275elementStart"](28,"ion-item"),u["\u0275\u0275elementStart"](29,"ion-label"),u["\u0275\u0275text"](30,"Efectivo"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275element"](31,"ion-radio",9),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](32,"ion-item"),u["\u0275\u0275elementStart"](33,"ion-label"),u["\u0275\u0275text"](34,"Tarjeta"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275element"](35,"ion-radio",10),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](36,"ion-row"),u["\u0275\u0275element"](37,"ion-col"),u["\u0275\u0275elementStart"](38,"ion-col"),u["\u0275\u0275elementStart"](39,"ion-button",11),u["\u0275\u0275listener"]("click",(function(){return u["\u0275\u0275restoreView"](n),u["\u0275\u0275nextContext"]().charge()})),u["\u0275\u0275text"](40," Realizar pedido "),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"]()}if(2&e){var r=u["\u0275\u0275nextContext"]();u["\u0275\u0275advance"](5),u["\u0275\u0275property"]("ngModel",r.deliveryType),u["\u0275\u0275advance"](9),u["\u0275\u0275property"]("ngIf","domicilio"==r.deliveryType),u["\u0275\u0275advance"](4),u["\u0275\u0275property"]("min",r.myDate)("ngModel",r.myDate),u["\u0275\u0275advance"](4),u["\u0275\u0275property"]("ngModel",r.orderNotes),u["\u0275\u0275advance"](5),u["\u0275\u0275property"]("ngModel",r.chargesType)}}var g,f,v,y=[{path:"",component:(g=function(){function n(t,r,o,i,a){e(this,n),this.http=t,this.navCtrl=r,this.loadingController=o,this.alertController=i,this.toastController=a,this.myDate=(new Date).toISOString(),this.products=[],this.total=0,this.family=[],this.orderNotes="",this.chargesType="tarjeta",this.deliveryType="tienda"}var r,o,i;return r=n,(o=[{key:"ngOnInit",value:function(){this.total=history.state.total,this.load()}},{key:"load",value:function(){var e=this;this.user=localStorage.getItem("identity"),this.user=JSON.parse(this.user);var t="",n=localStorage.getItem("cart");this.products=JSON.parse(n);for(var r=function(n){e.products[n].name=decodeURIComponent(e.products[n].name),e.family.forEach((function(r){r.id==e.products[n].familyId&&(t=r.name)})),e.products[n].familyName=t},o=0;o<this.products.length;o++)r(o);this.shippingType||(this.shipping=this.total>30?0:5)}},{key:"buy",value:function(){var e=this;this.orderNotes+="tienda"==this.deliveryType?" -  "+this.deliveryType:" - "+this.deliveryType+" - "+this.user[0].calle+" "+this.user[0].poblacion+" "+this.user[0].CP;var t={orderLines:JSON.stringify(this.products).replace(/\"/gi,"'"),cashDiscount:0,grossAmount:this.total,surchargeRate:0,netAmount:0,vatAmount:0,surchargeAmount:0,sended:!0,userId:this.user[0].id,userName:this.user[0].name+" "+this.user[0].lastname,userPhone:this.user[0].telefono,email:this.user[0].email,deliveryDate:this.myDate,orderNotes:this.orderNotes,chargesType:this.chargesType},n=new c.c({"Content-Type":"application/json",Authorization:localStorage.getItem("token")});this.http.post(m.a.APIURL+"/order",t,{headers:n}).subscribe((function(t){return Object(d.a)(e,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return localStorage.removeItem("cart"),localStorage.setItem("cart",JSON.stringify({})),e.next=4,this.toastController.create({message:"Pedido realizado \ud83c\udf89",duration:2e3,color:"success"});case 4:e.sent.present(),this.navCtrl.navigateRoot("/home");case 6:case"end":return e.stop()}}),e,this)})))}),(function(e){}))}},{key:"charge",value:function(){return Object(d.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadingController.create({message:"Preparando pedido...",translucent:!0});case 2:return t=e.sent,e.next=5,t.present();case 5:"tarjeta"==this.chargesType?window.StripeCheckout.configure({key:m.a.STRIPEPK,locale:"auto",token:function(e){var t={stripeToken:e.id,amount:100*n.total},r=new c.c({"Content-Type":"application/json",Accept:"application/json"});n.http.post(m.a.APIURL+"/charge",t,{headers:r}).subscribe((function(e){n.buy()}),(function(e){return Object(d.a)(n,void 0,void 0,regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.alertController.create({header:"Contacta con nosotros por favor",message:"Parece que tenemos problemas \ud83e\udd74",buttons:[{text:"Okay"}]});case 2:return t=e.sent,e.next=5,t.present();case 5:case"end":return e.stop()}}),e,this)})))}))}}).open({name:"Tu Empresa Checkout",description:"",amount:100*this.total}):this.buy(),this.loadingController.dismiss();case 7:case"end":return e.stop()}}),e,this)})))}}])&&t(r.prototype,o),i&&t(r,i),n}(),g.\u0275fac=function(e){return new(e||g)(u["\u0275\u0275directiveInject"](c.a),u["\u0275\u0275directiveInject"](l.Q),u["\u0275\u0275directiveInject"](l.O),u["\u0275\u0275directiveInject"](l.b),u["\u0275\u0275directiveInject"](l.X))},g.\u0275cmp=u["\u0275\u0275defineComponent"]({type:g,selectors:[["app-purchase-payment"]],decls:10,vars:1,consts:[["color","success"],["name","logo-whatsapp"],[4,"ngIf"],["value","efectivo",3,"ngModel","ngModelChange"],["slot","start","value","tienda"],["slot","start","value","domicilio"],["displayFormat","MMM DD, YYYY HH:mm","minuteValues","00,15, 30, 45",3,"min","ngModel","ngModelChange"],["position","floating"],[3,"ngModel","ngModelChange"],["slot","start","value","efectivo"],["slot","start","value","tarjeta"],[3,"click"],["type","text",3,"ngModel","ngModelChange"],["type","number",3,"ngModel","ngModelChange"],["type","tel",3,"ngModel","ngModelChange"]],template:function(e,t){1&e&&(u["\u0275\u0275elementStart"](0,"ion-content"),u["\u0275\u0275elementStart"](1,"ion-card"),u["\u0275\u0275elementStart"](2,"ion-card-header"),u["\u0275\u0275elementStart"](3,"h5"),u["\u0275\u0275text"](4,"\xbfProblemas con tu pedido?"),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementStart"](5,"ion-card-content"),u["\u0275\u0275elementStart"](6,"ion-button",0),u["\u0275\u0275text"](7,"Whatshap \xa0 "),u["\u0275\u0275element"](8,"ion-icon",1),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275elementEnd"](),u["\u0275\u0275template"](9,h,41,6,"div",2),u["\u0275\u0275elementEnd"]()),2&e&&(u["\u0275\u0275advance"](9),u["\u0275\u0275property"]("ngIf",t.user))},directives:[l.o,l.i,l.k,l.j,l.g,l.s,i.k,l.L,l.K,l.w,l.C,l.V,a.d,a.g,l.u,l.v,l.B,l.T,l.p,l.J,l.W,l.G,l.n,l.t,l.R],styles:["ion-col[_ngcontent-%COMP%]{text-align:right}ion-card[_ngcontent-%COMP%]{text-align:center}"]}),g)}],S=((v=function t(){e(this,t)}).\u0275mod=u["\u0275\u0275defineNgModule"]({type:v}),v.\u0275inj=u["\u0275\u0275defineInjector"]({factory:function(e){return new(e||v)},imports:[[s.i.forChild(y)],s.i]}),v),E=((f=function t(){e(this,t)}).\u0275mod=u["\u0275\u0275defineNgModule"]({type:f}),f.\u0275inj=u["\u0275\u0275defineInjector"]({factory:function(e){return new(e||f)},imports:[[i.b,a.a,l.M,S,a.i]]}),f)}}])}();